<!DOCTYPE html>
<html lang="en" ng-app='app'>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style/application.min.css">
    <style>
        body{background:#FFF;}
        hr{margin:0;border-top:1px solid #CCC;}
    </style>
    <title>Document</title>
</head>
<body>

<div class="form-horizontal" style="padding:20px;">
    <hr>
    forms:
    <hr>
    <adsense-properties></adsense-properties>

    <hr>
    elements:
    <hr>
    <simpletext output="simpletext" display-label="用户名" display-length="10"></simpletext>
    <simpletext output="simpletext" display-label="内容" display-dobulelength="30"></simpletext>
    <simpletext output="simpletext" display-label="文案" display-pattern="URL"></simpletext>
    <richtext output="richtext" display-label="贴子内容" display-dobulelength="35"></richtext>
</div>

<script src="js/angular.js"></script>
<script src="j_template.js"></script>
<script>
var appModule = angular.module('app', []);
appModule.directive('adsenseProperties', function() {
    function getProperties() {
        var ret = '';  // default value

        var properties = json;  // TODO: get from template

        properties.forEach(function(property, index){
            ret += getFormLabel(property);
        });

        return '<div>' + ret + '</div>';
    }

    function getFormLabel(property) {
        var ret = '';
        var type = property.type || '';
        var attr = property.attr || '';  // TODO: attr. bind
        if (type) {
            ret = '<%%type%% attr1="attr1"></%%type%%>'.replace(/%%type%%/g, type).replace(/%%attr%%/g, attr);
        }
        console.log(ret);
        return ret;
    }

    function link(scope, element, attrs) {
        var a;
    }

    return {
        restrict: 'EA',
        template: getProperties(),
        link: link,
        replace: true
    };
});

// ------------------------------
appModule.directive('simpletext', function() {
    function getTemplate() {
        var ret = '';
        ret = [
            '<div class="row goods_property">',
                '<div class="col-md-8">',
                    '<div class="control-group">',
                        '<label class="control-label">{{source.label}}</label>',
                        '<div class="controls form-group">',
                            '<input class="small-input" type="text">',
                        '</div>',
                    '</div>',
                '</div>',
                '<div class="col-md-4">',
                    '<div class="propertip"></div>',
                    '<div class="errmsg"></div>',
                '</div>',
            '</div>'
        ].join('');

        return ret;
    }

    function link(scope, elem, attr, ctrl) {
        scope.source = {
            label: attr.displayLabel || '',
            button_text:  attr.displayButtonText ||'',
            tip_text:  attr.displayTipText || ''
        };
    }

    return {
        restrict: 'EA',
        template: getTemplate(),
        scope:{
            output:'='
        },
        link: link,
        transclude: true,
        replace: true
    };
});

// ------------------------------
appModule.directive('richtext', function() {
    function getTemplate() {
        var ret = '';
        ret = [
            '<div class="row goods_property">',
                '<div class="col-md-8">',
                    '<div class="control-group">',
                        '<label class="control-label">{{source.label}}</label>',
                        '<div class="controls form-group">',
                            '<textarea class="small-input"></textarea>',
                        '</div>',
                    '</div>',
                '</div>',
                '<div class="col-md-4">',
                    '<div class="propertip"></div>',
                    '<div class="errmsg"></div>',
                '</div>',
            '</div>'
        ].join('');

        return ret;
    }

    function link(scope, elem, attr, ctrl) {
        scope.source = {
            label: attr.displayLabel || '',
            button_text:  attr.displayButtonText ||'',
            tip_text:  attr.displayTipText || ''
        };
    }

    return {
        restrict: 'EA',
        template: getTemplate(),
        scope:{
            output:'='
        },
        link: link,
        transclude: true,
        replace: true
    };
});

// ------------------------------
appModule.directive('upload', function() {
    function getTemplate() {
        var ret = '';
        ret = [
            '<div class="row goods_property">',
                '<div class="col-md-8">',
                    '<div class="control-group">',
                        '<label class="control-label">{{source.label}}</label>',
                        '<div class="controls form-group">',
                            'uploader...',
                        '</div>',
                    '</div>',
                '</div>',
                '<div class="col-md-4">',
                    '<div class="propertip"></div>',
                    '<div class="errmsg"></div>',
                '</div>',
            '</div>'
        ].join('');

        return ret;
    }

    function link(scope, elem, attr, ctrl) {
        scope.source = {
            label: attr.displayLabel || '',
            button_text:  attr.displayButtonText ||'',
            tip_text:  attr.displayTipText || ''
        };
    }

    return {
        restrict: 'EA',
        template: getTemplate(),
        scope:{
            output:'='
        },
        link: link,
        transclude: true,
        replace: true
    };
});

</script>

</body>
</html>