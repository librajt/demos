<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>JS sticky</title>
<style>
    body{margin:0;}
    
    .mod{overflow:hidden;}
    .mod .hdWrap.fixed{position:fixed;z-index:1;top:-1px;left:0;right:0;}
    .mod .ttl{padding:0 10px;font-size:16px;color:#333333;line-height:24px;background:#CCCCCC;border:1px solid #999999;border-width:1px 0;}
    .mod .it{padding:0 10px;font-size:14px;color:#666666;line-height:36px;border-bottom:1px solid #CCCCCC;}
    .mod .it:last-child{border:0;}
    
    html,body{height:100%;}
    .page{position:absolute;top:0;bottom:0;left:0;right:0;}
    .pageWrap{position:absolute;top:0;left:0;right:0;}
    
</style>
<script src="http://lab.cubiq.org/iscroll/src/iscroll-lite.js"></script>
</head>
<body>

    <div class="mod fixedModHd"><div class="hd"><div class="hdWrap"></div></div></div>
    
    <div class="page" id="scrollPage">
        <div class="pageWrap">
        
            <h1>Sticky Test - iScroll version</h1>
            <h3>works well on mobile modern browsers</h3>
            <h4><a href="index.htm">see desktop versition</a></h4>
            
            <div class="mod">
                <div class="hd">
                    <div class="hdWrap"><div class="ttl">Adobe</div></div>
                </div>
                <div class="bd">
                    <div class="ls">
                        <div class="it">Monday</div>
                        <div class="it">Tuesday</div>
                        <div class="it">Wednesday</div>
                    </div>
                </div>
            </div>
            
            <div class="mod">
                <div class="hd">
                    <div class="hdWrap"><div class="ttl">Bootstrap</div></div>
                </div>
                <div class="bd">
                    <div class="ls">
                        <div class="it">Thursday</div>
                        <div class="it">Friday</div>
                        <div class="it">Saturday</div>
                        <div class="it">Sunday</div>
                    </div>
                </div>
            </div>
            
            <div class="mod">
                <div class="hd">
                    <div class="hdWrap"><div class="ttl">Colorpicker</div></div>
                </div>
                <div class="bd">
                    <div class="ls">
                        <div class="it">Monday</div>
                        <div class="it">Tuesday</div>
                        <div class="it">Wednesday</div>
                        <div class="it">Thursday</div>
                        <div class="it">Friday</div>
                    </div>
                </div>
            </div>
            
            <div class="mod">
                <div class="hd">
                    <div class="hdWrap"><div class="ttl">Danger</div></div>
                </div>
                <div class="bd">
                    <div class="ls">
                        <div class="it">Saturday</div>
                        <div class="it">Sunday</div>
                    </div>
                </div>
            </div>
            
            <div class="mod">
                <div class="hd">
                    <div class="hdWrap"><div class="ttl">Colorpicker</div></div>
                </div>
                <div class="bd">
                    <div class="ls">
                        <div class="it">Monday</div>
                        <div class="it">Tuesday</div>
                        <div class="it">Wednesday</div>
                        <div class="it">Thursday</div>
                        <div class="it">Friday</div>
                    </div>
                </div>
            </div>
            
            <div class="mod">
                <div class="hd">
                    <div class="hdWrap"><div class="ttl">Danger</div></div>
                </div>
                <div class="bd">
                    <div class="ls">
                        <div class="it">Saturday</div>
                        <div class="it">Sunday</div>
                    </div>
                </div>
            </div>
            
            <div class="mod">
                <div class="hd">
                    <div class="hdWrap"><div class="ttl">Colorpicker</div></div>
                </div>
                <div class="bd">
                    <div class="ls">
                        <div class="it">Monday</div>
                        <div class="it">Tuesday</div>
                        <div class="it">Wednesday</div>
                        <div class="it">Thursday</div>
                        <div class="it">Friday</div>
                    </div>
                </div>
            </div>
            
            <div class="mod">
                <div class="hd">
                    <div class="hdWrap"><div class="ttl">Danger</div></div>
                </div>
                <div class="bd">
                    <div class="ls">
                        <div class="it">Saturday</div>
                        <div class="it">Sunday</div>
                    </div>
                </div>
            </div>
            
            <div class="mod">
                <div class="hd">
                    <div class="hdWrap"><div class="ttl">Colorpicker</div></div>
                </div>
                <div class="bd">
                    <div class="ls">
                        <div class="it">Monday</div>
                        <div class="it">Tuesday</div>
                        <div class="it">Wednesday</div>
                        <div class="it">Thursday</div>
                        <div class="it">Friday</div>
                    </div>
                </div>
            </div>
            
            <div class="mod">
                <div class="hd">
                    <div class="hdWrap"><div class="ttl">Danger</div></div>
                </div>
                <div class="bd">
                    <div class="ls">
                        <div class="it">Saturday</div>
                        <div class="it">Sunday</div>
                    </div>
                </div>
            </div>
            
            <div class="mod">
                <div class="hd">
                    <div class="hdWrap"><div class="ttl">Environment</div></div>
                </div>
                <div class="bd">
                    <div class="ls">
                        <div class="it">Monday</div>
                        <div class="it">Tuesday</div>
                        <div class="it">Wednesday</div>
                        <div class="it">Thursday</div>
                        <div class="it">Friday</div>
                        <div class="it">Saturday</div>
                        <div class="it">Sunday</div>
                        <div class="it">Monday</div>
                        <div class="it">Tuesday</div>
                        <div class="it">Wednesday</div>
                        <div class="it">Thursday</div>
                        <div class="it">Friday</div>
                        <div class="it">Saturday</div>
                        <div class="it">Sunday</div>
                        <div class="it">Monday</div>
                        <div class="it">Tuesday</div>
                        <div class="it">Wednesday</div>
                        <div class="it">Thursday</div>
                        <div class="it">Friday</div>
                        <div class="it">Saturday</div>
                        <div class="it">Sunday</div>
                        <div class="it">Monday</div>
                        <div class="it">Tuesday</div>
                        <div class="it">Wednesday</div>
                        <div class="it">Thursday</div>
                        <div class="it">Friday</div>
                        <div class="it">Saturday</div>
                        <div class="it">Sunday</div>
                    </div>
                </div>
            </div>
        
        </div>
    </div>

    <script>
        function onScroll(top, callback) {
            var mods, mod, i, hd, bd, hdTop, hdHeight, bdBottom, windowTop, el;
            
            mods = document.querySelectorAll('.page .mod');
            mods = [].slice.call(mods);
            windowTop = top;
            el = document.querySelector('.fixedModHd .hdWrap');
            
            el.innerHTML = '';
            
            mods.forEach(function(val, i) {
                mod = val;
                hd = mod.querySelector('.hd');
                bd = mod.querySelector('.bd');
                hdTop = hd.offsetTop + 1;  // border-top
                hdHeight = hd.offsetHeight;
                bdBottom = hdTop + bd.offsetHeight + 1;  // border-bottom
                
                if (hdTop <= windowTop && windowTop <= bdBottom + hdHeight) {
                    el.innerHTML = mod.querySelector('.hdWrap').innerHTML;
                    el.classList.add('fixed');
                    if (windowTop > bdBottom) {
                        el.style.marginTop = bdBottom - windowTop + 'px';
                    }
                    else {
                        el.style.marginTop = '';
                    }
                }
            });
            
            if (callback) callback();
        };
        
        /*
         * onTouchEnd 到 onScrollEnd 是惯性动画执行的过程
         * 在此期间，用定时器延续 onScrollMove 事件，其中的 40ms = 1s / 25fps
         * 为了阻止定时器永久执行，设定了定时器执行次数为100，即大约4s后惯性动画执行完毕
         *
         */
        
        var myScroll, myInterval, count = 0;
        
        function loaded() {
            myScroll = new iScroll('scrollPage', {
                onScrollMove: function() {
                    onScroll(-this.y);
                },
                onTouchEnd: function() {
                    var self = this;
                    count = 0;
                    clearInterval(myInterval);
                    myInterval = setInterval(function() {
                        onScroll(-self.y, function() {
                            if (count++ >= 100) clearInterval(myInterval);
                        });
                        console.log('setInterval');
                    }, 40);
                    console.log('touchend');
                },
                onScrollEnd: function() {
                    clearInterval(myInterval);
                    console.log('onScrollEnd');
                }
            });
        }

        document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);

        /* * * * * * * *
         *
         * Use this for high compatibility (iDevice + Android)
         *
         */
        document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);
        /*
         * * * * * * * */


        /* * * * * * * *
         *
         * Use this for iDevice only
         *
         */
        //document.addEventListener('DOMContentLoaded', loaded, false);
        /*
         * * * * * * * */


        /* * * * * * * *
         *
         * Use this if nothing else works
         *
         */
        //window.addEventListener('load', setTimeout(function () { loaded(); }, 200), false);
        /*
         * * * * * * * */
    </script>
</body>
</html>
